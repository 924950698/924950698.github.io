(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{375:function(t,e,r){"use strict";r.r(e);var a=r(10),v=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"火焰图-linux下的性能监控"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#火焰图-linux下的性能监控"}},[t._v("#")]),t._v(" 火焰图 -- Linux下的性能监控")]),t._v(" "),e("p",[e("b",[t._v(" 大家先看效果图： ")]),t._v(" "),e("img",{attrs:{src:"https://i.loli.net/2019/06/17/5d07adc78257730405.png",alt:""}})]),t._v(" "),e("p",[e("a",{attrs:{href:"https://blog.csdn.net/gatieme/article/details/78885908",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客传送门"),e("OutboundLink")],1)]),t._v(" "),e("ol",[e("li",[t._v("先查看Linux系统版本: "),e("code",[t._v("cat /etc/centos-release")])]),t._v(" "),e("li",[t._v("根据系统版本，安装perf： "),e("code",[t._v("yum install perf")])]),t._v(" "),e("li",[t._v("安装git: "),e("code",[t._v("yum -y install git")])]),t._v(" "),e("li",[t._v("查看git版本："),e("code",[t._v("git --version")])]),t._v(" "),e("li",[t._v("注册gitHub账号，并给git添加用户名： "),e("code",[t._v("useradd xxx")]),e("br"),t._v("\n输入： "),e("code",[t._v("passwd xxx")]),t._v("以后，就会提示用户输入密码")]),t._v(" "),e("li",[t._v("创建项目文件夹： "),e("code",[t._v("mkdir FlameGraph")])]),t._v(" "),e("li",[t._v("进入文件夹，并克隆火焰图代码："),e("code",[t._v("git clone https://github.com/brendangregg/FlameGraph.git")])]),t._v(" "),e("li",[t._v("先查看进程号，查看cpu前10的进程号："),e("code",[t._v("ps aux|head -1;ps aux|grep -v PID|sort -rn -k +3|head")])]),t._v(" "),e("li",[t._v("执行："),e("code",[t._v("perf record -F 99 -p 1941 -g -- sleep 30")])]),t._v(" "),e("li",[t._v("在执行："),e("code",[t._v("perf report -n --stdio")])])]),t._v(" "),e("h3",{attrs:{id:"参照下图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参照下图"}},[t._v("#")]),t._v(" 参照下图")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://i.loli.net/2019/06/17/5d07b1a807b4021228.jpg",alt:""}})]),t._v(" "),e("h3",{attrs:{id:"生成火焰图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成火焰图"}},[t._v("#")]),t._v(" 生成火焰图：")]),t._v(" "),e("ol",{attrs:{start:"11"}},[e("li",[e("p",[t._v("首选生成折叠后的调用栈："),e("code",[t._v("perf script -i perf.data &> perf.unfold")])])]),t._v(" "),e("li",[e("p",[t._v("然后生成火焰图： "),e("code",[t._v("./stackcollapse-perf.pl perf.unfold &> perf.folded")])])]),t._v(" "),e("li",[e("p",[t._v("最后生成 svg 图: "),e("code",[t._v("./flamegraph.pl perf.folded > perf.svg")])])]),t._v(" "),e("li",[e("p",[t._v("如下图所示：\n"),e("img",{attrs:{src:"https://i.loli.net/2019/06/17/5d07b2a37615277052.jpg",alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("将Linux文件中的perf.svg下载到本地："),e("code",[t._v("scp root@62.234.67.162:/root/FlameGraph/FlameGraph/perf.svg ./")])])]),t._v(" "),e("li",[e("p",[t._v("操作完成。找到对应目录打开文件在浏览器查看即可。")])])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://i.loli.net/2019/06/17/5d07b3822558732366.png",alt:""}})])])}),[],!1,null,null,null);e.default=v.exports}}]);